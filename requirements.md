# 医療パンフレット作成支援デモシステム 要件定義書

## 1. プロジェクト概要

### 1.1 背景
- 本プロジェクトは「医療業界特化型AI搭載パンフレット作成支援システム」（propose.md参照）のデモ版として開発する
- 最終システムでは年間40〜50件のパンフレット作成に対し、10名が関与し年間400〜800時間の作業コストが発生している課題を解決することを目指す
- 本デモでは、その中核機能である「構成生成」と「RAG検索」の実現可能性を実証する

### 1.2 目的
- 医療関連資料（講演会音声、企画書、論文等）から、パンフレット素案の構成を自動生成するデモシステムを構築
- Azure Document Intelligence、Deepgram、Gemini、arXiv/PubMed APIを統合した処理フローの実証
- output_referenceにある完成物の構成を参考に、同様の品質の構成案を.txt形式で出力

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 入力データ処理機能
1. **ドキュメント処理（Azure Document Intelligence）**
   - 対象ファイル形式：PDF、Word（.doc/.docx）、PowerPoint（.pptx）
   - 処理内容：文字情報の抽出、構造化データへの変換
   - 対象ファイル：
     - input/企画：6JNETS記録集_企画案v2.docx
     - input/材料：JNETS記録集_資材化スライド候補.pptx
     - input/材料：記事化希望箇所.doc
     - input/output_reference/完成物：【最終】FUJI_APCCC座談会0921.pdf
     - input/output_reference/完成物：【最終校】FFTC_56th_1x8p_0314_P.pdf

2. **音声処理（Deepgram）**
   - 対象ファイル形式：MP3
   - 処理内容：音声の文字起こし、重要発言の抽出
   - 対象ファイル：
     - input/材料：20180908_LS富士フイルムRI.mp3

3. **論文検索機能**
   - **キーワード生成（Gemini）**
     - 入力データから医療関連キーワードを自動抽出
     - 検索クエリの最適化
   - **論文取得（arXiv/PubMed API）**
     - 取得件数：最大10件
     - 取得情報：タイトル、著者、要約、出版年、DOI等

#### 2.1.2 RAG（Retrieval-Augmented Generation）システム
1. **知識ベース構築**
   - 処理済みの全入力データ（文書、音声文字起こし、論文）を統合
   - ベクトルデータベースへの格納
   - 類似度検索の実装

2. **検索機能**
   - 意味的類似度に基づく関連情報の検索
   - コンテキストを考慮した情報抽出

#### 2.1.3 構成生成機能
1. **構成案作成**
   - output1.txtのフォーマットに準拠した構成生成
   - 大構成と詳細構成の2段階生成
   - 各セクションの見出しと概要の生成

2. **出力フォーマット**
   - ファイル形式：.txt
   - 内容構成：
     - 大構成：セクション名、文字数目安、概要説明、抜粋
     - 詳細構成：書くべき内容の要点、使用する図表、参考文献

### 2.2 非機能要件

#### 2.2.1 性能要件
- 処理時間：1ファイルあたり最大5分程度
- 同時処理：シングルスレッドでの順次処理

#### 2.2.2 セキュリティ要件
- API認証情報は環境変数（.env）で管理
- 処理データはローカル環境内で完結

#### 2.2.3 開発環境
- プログラミング言語：Python 3.9
- 仮想環境：venv（既に設定済み）

## 3. システム構成

### 3.1 全体アーキテクチャ
```
[入力データ]
    ├── Word/PowerPoint/PDF → [Azure Document Intelligence] → [テキストデータ]
    ├── MP3音声 → [Deepgram] → [文字起こしデータ]
    └── 抽出テキスト → [Gemini] → [検索キーワード] → [arXiv/PubMed] → [論文データ]
                            ↓
                    [RAGシステム（知識ベース）]
                            ↓
                    [構成生成エンジン]
                            ↓
                    [構成案（.txt出力）]
```

### 3.2 処理フロー
1. **Phase 1: データ収集・処理**
   - inputフォルダ内の全ファイルを処理
   - Azure Document IntelligenceでPDF/Word/PowerPointを解析
   - Deepgramで音声ファイルを文字起こし

2. **Phase 2: 論文検索**
   - Geminiで処理済みテキストから検索キーワードを生成
   - arXiv/PubMed APIで関連論文を検索（最大10件）

3. **Phase 3: RAG構築**
   - 全データをベクトル化
   - 知識ベースとして統合

4. **Phase 4: 構成生成**
   - output_referenceのフォーマットを参照
   - RAGを活用して関連情報を抽出
   - 構成案を生成し.txt形式で出力

## 4. API仕様

### 4.1 使用API一覧
| API名 | 用途 | 認証方法 |
|-------|------|----------|
| Azure Document Intelligence | 文書解析 | APIキー（.env） |
| Deepgram | 音声文字起こし | APIキー（.env） |
| Gemini | キーワード生成 | APIキー（.env） |
| arXiv API | 論文検索 | 認証不要 |
| PubMed API | 論文検索 | 認証不要 |

### 4.2 環境変数設定
```
AZURE_DOCUMENT_INTELLIGENCE_KEY=<APIキー>
AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT=<エンドポイント>
DEEPGRAM_API_KEY=<APIキー>
GEMINI_API_KEY=<APIキー>
```

## 5. 入出力仕様

### 5.1 入力データ
- **場所**: `/input/`フォルダ
- **ファイル種別**:
  - 企画資料: .docx
  - 発表資料: .pptx
  - 音声記録: .mp3
  - 参考資料: .doc
- **output_reference**: 完成物のPDFサンプル

### 5.2 出力データ
- **形式**: .txt
- **内容**: 
  - 大構成（セクション、サブセクション、文字数、概要、抜粋）
  - 詳細構成（書くべき内容の要点、使用図表、参考文献）
- **保存先**: `/output/`フォルダ（新規作成）

## 6. 開発優先順位

### Phase 1（必須機能）
1. Azure Document Intelligenceによる文書処理
2. Deepgramによる音声処理
3. 基本的な構成生成機能
4. テキストファイル出力

### Phase 2（追加機能）
1. Geminiによるキーワード生成
2. arXiv/PubMed論文検索
3. RAGシステムの実装
4. 構成生成の高度化

## 7. 成功基準
1. inputフォルダ内の全ファイルが正常に処理できること
2. output_referenceと同様の構成フォーマットで出力できること
3. 各セクションに適切な見出しと概要が生成されること
4. エラーハンドリングが適切に実装されていること

## 8. 制約事項
1. デモ版のため、UIは実装しない（コマンドライン実行）
2. 品質スコアリングは実装しない
3. 論文検索は最大10件に制限
4. 処理は同期的に実行（非同期処理は実装しない）

## 9. 今後の拡張予定（本開発時）
- Webインターフェースの実装
- 品質チェック機能の追加
- JPMAルール準拠チェック
- 複数ユーザー対応
- バッチ処理機能